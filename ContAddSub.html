<!DOCTYPE html>
<html lang="en">
<head>
     <link rel="stylesheet" href="elegant-theme.css">
    <script src="gamify.js" defer></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Li'l Champs Abacus Academy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap');

        html, body {
            height: 100%;
            width: 100%;
            overflow: hidden;
            position: fixed;
            touch-action: none;
            margin: 0;

            font-family: 'Nunito', sans-serif;
            background-color: #f0f9ff;
            background-image: radial-gradient(#e0f2fe 2px, transparent 2px);
            background-size: 24px 24px;
            
            display: flex;
            flex-direction: column;
        }

        main {
            flex-grow: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1.5rem 0;
        }

        .screen-container {
            max-width: 480px;
            margin: auto;
            padding: 1.5rem;
            width: 100%;
        }
        .card {
            background-color: white;
            padding: 2rem;
            border-radius: 1.5rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 5px 15px -5px rgba(0, 0, 0, 0.04);
        }
        .feedback-correct {
            border-color: #10B981 !important; /* Green 500 */
            background-color: #ECFDF5; /* Green 50 */
        }
        .feedback-wrong {
            border-color: #EF4444 !important; /* Red 500 */
            background-color: #FEF2F2; /* Red 50 */
        }
    </style>
</head>
<body oncontextmenu="return false;">
    <header class="bg-indigo-600 text-white p-4 shadow-lg sticky top-0 z-10 flex-none">
        <h1 class="text-2xl font-extrabold text-center tracking-wide">Li'l Champs Abacus Academy Ambernath</h1>
    </header>

    <main>
         <h2 class="text-3xl font-extrabold text-blue-900 mb-6 text-center">Continuous Addition/Subtraction Practice</h2>
        <div class="screen-container">

            <div id="setupScreen" class="card">
                <h2 class="text-xl font-bold text-gray-800 mb-6">Start Your Practice</h2>
                
                <div class="space-y-4">
                    <div class="text-lg font-bold text-indigo-700 mb-6 border-b pb-2">
                        Student: <span id="autoStudentNameDisplay" class="text-indigo-900">... Loading ...</span>
                    </div>

                    <div>
                        <label for="startNumber" class="block text-sm font-medium text-gray-700 mb-1" id="startNumberLabel">Number to subtract in each step</label>
                        <select id="startNumber" class="w-full p-3 border border-gray-300 rounded-lg bg-white focus:ring-indigo-500 focus:border-indigo-500">
                            <optgroup label="1st level">
                                <option value="2">2</option><option value="3">3</option><option value="4">4</option>
                                <option value="5">5</option><option value="6">6</option><option value="7">7</option>
                                <option value="8">8</option><option value="9">9</option>
                            </optgroup>
                            <optgroup label="2nd level">
                                <option value="22">22</option><option value="33">33</option><option value="44">44</option>
                                <option value="55">55</option><option value="66" selected>66</option><option value="77">77</option>
                                <option value="88">88</option><option value="99">99</option>
                            </optgroup>
                            <optgroup label="3rd Level">
                                <option value="222">222</option><option value="333">333</option><option value="444">444</option>
                                <option value="555">555</option><option value="666">666</option><option value="777">777</option>
                                <option value="888">888</option><option value="999">999</option>
                            </optgroup>
                            <optgroup label="4th Level">
                                <option value="2222">2,222</option><option value="3333">3,333</option><option value="4444">4,444</option>
                                <option value="5555">5,555</option><option value="6666">6,666</option><option value="7777">7,777</option>
                                <option value="8888">8,888</option><option value="9999">9,999</option>
                            </optgroup>
                        </select>
                    </div>

                    <div>
                        <label for="stepCount" class="block text-sm font-medium text-gray-700 mb-1">Number of Steps</label>
                        <select id="stepCount" class="w-full p-3 border border-gray-300 rounded-lg bg-white">
                            <option value="10">10 Steps</option><option value="20" selected>20 Steps</option>
                            <option value="30">30 Steps</option><option value="40">40 Steps</option>
                            <option value="50">50 Steps</option><option value="100">100 Steps</option>
                        </select>
                    </div>

                    <div class="pt-2">
                        <span class="text-sm font-medium text-gray-700 block mb-2">Select Operation</span>
                        <div class="flex space-x-4">
                              <label class="flex items-center space-x-2 p-3 border rounded-lg cursor-pointer transition has-[:checked]:border-indigo-500 has-[:checked]:bg-indigo-50">
                                   <input type="radio" name="operation" value="addition" checked class="form-radio text-indigo-600">
                                   <span class="text-sm font-medium text-gray-900">Cont. Addition</span>
                              </label>
                              <label class="flex items-center space-x-2 p-3 border rounded-lg cursor-pointer transition has-[:checked]:border-indigo-500 has-[:checked]:bg-indigo-50">
                                   <input type="radio" name="operation" value="subtraction" class="form-radio text-indigo-600">
                                   <span class="text-sm font-medium text-gray-900">Cont. Subtraction</span>
                              </label>
                        </div>
                    </div>

                    <button id="startButton" class="w-full bg-indigo-600 text-white p-3 rounded-lg font-semibold hover:bg-indigo-700 transition shadow-lg mt-6" disabled>
                        Start Practice
                    </button>
                    <p id="setupError" class="text-sm text-red-600 text-center mt-2 hidden"></p>
                </div>
            </div>

            <div id="practiceScreen" class="card hidden text-center">
                <p id="studentDisplay" class="text-lg font-medium text-indigo-600 mb-2"></p>
                <p id="stepDisplay" class="text-sm font-medium text-gray-500 mb-4"></p>
                
                <div class="bg-gray-100 p-6 rounded-xl shadow-inner mb-6">
                    <p class="text-sm text-gray-600">Current Value</p>
                    <p id="currentNumber" class="text-5xl font-extrabold text-gray-900 mt-1"></p>
                    <p id="operationText" class="text-xl font-bold text-indigo-500 mt-2"></p>
                </div>

                <label for="answerInput" class="block text-sm font-medium text-gray-700 mb-2">Enter Your Answer</label>
                <input type="number" id="answerInput" placeholder="Type answer..." class="text-center text-2xl font-bold w-full p-4 border-4 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500" autocomplete="off">
                <p id="answerFeedback" class="text-sm mt-3 font-bold"></p>
            </div>

            <div id="completionScreen" class="card hidden text-center">
                <h2 class="text-2xl font-bold text-gray-800 mt-4 mb-2">Practice Complete!</h2>
                <p id="completionMessage" class="text-lg text-gray-600 mb-6"></p>
                <p id="dateTimeDisplay" class="text-sm text-gray-500 mb-8 font-medium"></p>
                <button id="mainPageButton" class="w-full bg-indigo-600 text-white p-3 rounded-lg font-semibold hover:bg-indigo-700 shadow-lg">
                    Go to Main Page
                </button>
            </div>

            <div class="w-full text-center mt-8">
                <a href="plus_minus.html" class="text-blue-600 hover:text-blue-800 font-semibold underline">
                    &larr; Back to Plus Minus
                </a>
            </div>
        </div>
    </main>

    <footer class="bg-white text-center p-6 mt-auto border-t border-gray-200 flex-none">
        <p class="text-sm text-gray-500">Developed by: Practice Buddy Pvt Ltd</p>
    </footer>

    <script>
        let state = { studentName: '', studentNumber: 0, totalSteps: 0, operation: '', currentStep: 0, currentValue: 0, targetValue: 0 };
        const $ = id => document.getElementById(id);
        const setupScreen = $('setupScreen'), practiceScreen = $('practiceScreen'), completionScreen = $('completionScreen');
        const startButton = $('startButton'), mainPageButton = $('mainPageButton'), autoStudentNameDisplay = $('autoStudentNameDisplay');
        const startNumberInput = $('startNumber'), startNumberLabel = $('startNumberLabel'), stepCountSelect = $('stepCount');
        const studentDisplay = $('studentDisplay'), stepDisplay = $('stepDisplay'), currentNumberDisplay = $('currentNumber');
        const operationText = $('operationText'), answerInput = $('answerInput'), answerFeedback = $('answerFeedback');
        const completionMessage = $('completionMessage'), dateTimeDisplay = $('dateTimeDisplay');

        function formatStudentName(identifier) {
            if (!identifier) return 'Student';
            const namePart = identifier.split('@')[0];
            return namePart.split('.').map(part => part.charAt(0).toUpperCase() + part.slice(1).toLowerCase()).join(' ') || identifier; 
        }

        function showScreen(screenId) {
            setupScreen.classList.add('hidden'); practiceScreen.classList.add('hidden'); completionScreen.classList.add('hidden');
            if (screenId === 'setup') { setupScreen.classList.remove('hidden'); startNumberInput.focus(); }
            else if (screenId === 'practice') { practiceScreen.classList.remove('hidden'); answerInput.focus(); }
            else if (screenId === 'complete') { completionScreen.classList.remove('hidden'); }
        }

        function updatePracticeDisplay() {
            answerInput.value = '';
            answerInput.classList.remove('feedback-correct', 'feedback-wrong');
            answerInput.disabled = false;
            answerFeedback.textContent = '';
            currentNumberDisplay.textContent = state.currentValue;
            stepDisplay.textContent = `Step ${state.currentStep} of ${state.totalSteps}`;
            const operationSign = state.operation === 'addition' ? '+' : '-';
            operationText.textContent = `${operationSign} ${state.studentNumber}`;
        }

        function startGame() {
            const num = parseInt(startNumberInput.value, 10), steps = parseInt(stepCountSelect.value, 10);
            const operation = document.querySelector('input[name="operation"]:checked').value;
            state.studentNumber = num; state.totalSteps = steps; state.operation = operation; state.currentStep = 1;
            if (operation === 'addition') { state.currentValue = 0; state.targetValue = num; } 
            else { state.currentValue = num * (steps + 1); state.targetValue = state.currentValue - num; }
            studentDisplay.textContent = `Hello, ${state.studentName}!`;
            updatePracticeDisplay();
            showScreen('practice');
        }

        function nextStep() {
            state.currentStep++;
            if (state.currentStep > state.totalSteps) {
                sendDataToGoogleSheet();
                const now = new Date();
                completionMessage.textContent = `Excellent work, ${state.studentName}! Completed ${state.totalSteps} steps of ${state.operation}.`;
                dateTimeDisplay.textContent = `Finished: ${now.toLocaleString()}`;
                showScreen('complete');
                return;
            }
            state.currentValue = state.targetValue;
            state.targetValue = (state.operation === 'addition') ? state.currentValue + state.studentNumber : state.currentValue - state.studentNumber;
            updatePracticeDisplay();
            answerInput.focus();
        }

        function checkAnswer() {
            const studentAnswer = parseInt(answerInput.value, 10);
            if (isNaN(studentAnswer)) { answerInput.classList.remove('feedback-correct', 'feedback-wrong'); return; }
            if (studentAnswer === state.targetValue) {
                answerInput.classList.add('feedback-correct'); answerInput.classList.remove('feedback-wrong');
                answerFeedback.textContent = 'Correct! Press Enter for next step.';
                answerFeedback.className = 'text-sm mt-3 font-bold text-green-600';
            } else {
                answerInput.classList.add('feedback-wrong'); answerInput.classList.remove('feedback-correct');
                answerFeedback.textContent = 'Keep trying!';
                answerFeedback.className = 'text-sm mt-3 font-bold text-red-600';
            }
        }

        function sendDataToGoogleSheet() {
            const scriptURL = "https://script.google.com/macros/s/AKfycbwzaHaLlh8hdi6Vv2baqSh-b1XfDRRgSkEjO8mlPlOvnJh10adABNaswqDvmzIyhR6n/exec";
            fetch(scriptURL, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ studentName: state.studentName, operation: state.operation, number: state.studentNumber, steps: state.totalSteps }) });
        }
         
        startButton.addEventListener('click', startGame);
        mainPageButton.addEventListener('click', () => showScreen('setup'));
        answerInput.addEventListener('input', checkAnswer);
        answerInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                if (parseInt(answerInput.value, 10) === state.targetValue) nextStep();
                else checkAnswer();
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            const sid = sessionStorage.getItem('studentIdentifier');
            if (!sid) { window.location.href = 'index.html'; return; }
            state.studentName = formatStudentName(sid);
            autoStudentNameDisplay.textContent = state.studentName;
            startButton.disabled = false;
            startButton.textContent = `Start Practice for ${state.studentName}`;
            showScreen('setup');
        });
    </script>
</body>
</html>

