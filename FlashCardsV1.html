<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abacus Flashcards</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fff;
            color: #1a202c;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }
        .container {
            max-width: 3xl;
            width: 100%;
            background-color: #f7fafc;
            border-radius: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            width: 100%;
        }
        .input-field {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .input-field label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            color: #2d3748;
        }
        .input-field input, .input-field select {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.75rem;
            border: 2px solid #e2e8f0;
            background-color: #fff;
            font-size: 1rem;
        }
        .start-button {
            width: 100%;
            padding: 1rem;
            background-color: #4a5568;
            color: white;
            font-weight: 700;
            border-radius: 0.75rem;
            transition: background-color 0.2s ease-in-out;
            margin-top: 1.5rem;
        }
        .start-button:hover {
            background-color: #2d3748;
        }
        .message-box {
            background-color: #f7fafc;
            border: 2px solid #cbd5e0;
            color: #4a5568;
            padding: 1rem;
            border-radius: 0.75rem;
            text-align: center;
            font-weight: 600;
            margin-top: 1.5rem;
            display: none;
        }
        .flashcard-display {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            margin-top: 1.5rem;
            width: 100%;
        }
        .abacus-container {
            width: 100%;
            max-width: 400px;
            height: auto;
        }
        .abacus-container svg {
            width: 100%;
            height: 100%;
        }
        .current-number {
            font-size: 3rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 1rem;
        }
        .control-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        .control-buttons button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            transition: background-color 0.2s ease-in-out;
        }
        .stop-button {
            background-color: #e53e3e;
            color: white;
        }
        .stop-button:hover {
            background-color: #c53030;
        }
        .reset-button {
            background-color: #48bb78;
            color: white;
        }
        .reset-button:hover {
            background-color: #38a169;
        }

        .results-display {
            display: none;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }
        .results-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(6rem, 1fr));
            gap: 0.5rem;
            margin-top: 1.5rem;
            width: 100%;
            max-height: 400px;
            overflow-y: auto;
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 0.75rem;
        }
        .results-list-item {
            text-align: center;
            font-size: 1.25rem;
            font-weight: 600;
            color: #4a5568;
            padding: 0.5rem;
            background-color: #edf2f7;
            border-radius: 0.5rem;
        }
        /* New style for the countdown text */
        .countdown-text {
            font-size: 4rem;
            font-weight: 900;
            color: #2d3748;
            text-align: center;
            display: none;
            margin-top: 1.5rem;
        }

        /* The styles below are all mobile-first, ensuring the layout is responsive on small screens. */
        @media (min-width: 640px) {
            .input-group {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: space-between;
            }
            .input-field {
                flex: 1 1 30%;
            }
            .start-button {
                flex-grow: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-3xl font-bold mb-6 text-center">Li'l Champs Abacus Academy Ambernath</h1>
        <p class="text-sm text-center mb-6 text-gray-600">Enter your practice settings below. All values must be valid numbers.</p>

        <div id="controls" class="w-full flex flex-col items-center">
            <div class="input-group">
                <div class="input-field">
                    <label for="digits">Number of Digits (1-6)</label>
                    <input type="number" id="digits" min="1" max="6" value="3" class="shadow-sm">
                </div>
                <div class="input-field">
                    <label for="total">Total Flashcards</label>
                    <input type="number" id="total" min="1" value="20" class="shadow-sm">
                </div>
                <div class="input-field">
                    <label for="speed">Speed (seconds)</label>
                    <input type="number" id="speed" min="0.5" step="0.5" value="1.5" class="shadow-sm">
                </div>
            </div>
            <button id="startButton" class="start-button shadow-md">Start Practice</button>
            <p><a href="practice_options.html">‚Üê Back to Options</a></p>
        </div>
        
        <!-- New element for countdown messages -->
        <div id="countdown" class="countdown-text"></div>

        <div id="flashcardDisplay" class="flashcard-display">
            <p class="current-number" id="currentNumber"></p>
            <div id="abacusContainer" class="abacus-container"></div>
            <div class="control-buttons">
                <button id="stopButton" class="stop-button shadow-md">Stop</button>
                <button id="resetButton" class="reset-button shadow-md">Reset</button>
            </div>
        </div>
        
        <div id="resultsDisplay" class="results-display">
            <h2 class="text-2xl font-bold text-center mt-4">Practice Results</h2>
            <div id="resultsList" class="results-list"></div>
            <button id="backButton" class="start-button shadow-md mt-6">Back to Main Screen</button>
        </div>

        <div id="messageBox" class="message-box"></div>
        <p class="text-sm text-center text-gray-600 mt-4">Contact: 9730482629</p>
    </div>

    <script>
        // Global variables for the app state
        const settings = {
            digits: 3,
            total: 20,
            speed: 1.5,
        };
        let flashcardNumbers = [];
        let currentIndex = 0;
        let flashcardTimer = null;
        
        // Define a constant for the maximum number of digits to ensure consistent sizing.
        const MAX_DIGITS = 6;

        /**
         * Generates the SVG points for a hexagon.
         * @param {number} x The x-coordinate of the center.
         * @param {number} y The y-coordinate of the center.
         * @param {number} r The radius of the hexagon (distance from center to a vertex).
         * @returns {string} A string of points for the SVG polygon element.
         */
        function getHexagonPoints(x, y, r) {
            const SQRT3 = Math.sqrt(3);
            const points = [
                `${x + r},${y}`,
                `${x + r * 0.5},${y + r * SQRT3 * 0.5}`,
                `${x - r * 0.5},${y + r * SQRT3 * 0.5}`,
                `${x - r},${y}`,
                `${x - r * 0.5},${y - r * SQRT3 * 0.5}`,
                `${x + r * 0.5},${y - r * SQRT3 * 0.5}`
            ];
            return points.join(' ');
        }

        /**
         * Generates an SVG string for an abacus based on a number and number of digits.
         * This function now ensures the total canvas size is consistent for 1-6 digits.
         * @param {number} number The number to display on the abacus.
         * @param {number} digits The total number of rods to display.
         * @returns {string} The SVG string for the abacus.
         */
        function generateAbacusSVG(number, digits) {
            const numDigits = digits;
            const scaleFactor = 1;

            const ROD_WIDTH = 2 * scaleFactor;
            const BEAM_HEIGHT = 5 * scaleFactor;
            const BEAD_RADIUS = 10 * scaleFactor;
            const TOP_BEADS = 1;
            const BOTTOM_BEADS = 4;
            const ROD_SPACING = 30 * scaleFactor;
            const BEAM_Y = 60 * scaleFactor;
            const BEAD_SPACING_Y = (BEAD_RADIUS * 2 * 1.05);
            const ABACUS_COLOR = "#000";
            const OUTLINE_COLOR = "yellow";
            const FRAME_PADDING = 15 * scaleFactor;

            // Calculate width based on MAX_DIGITS to ensure a consistent canvas size
            const width = (MAX_DIGITS * ROD_SPACING) + ROD_SPACING;
            const height = BEAM_Y + (BEAD_RADIUS * 2) + (BOTTOM_BEADS * BEAD_SPACING_Y) + (2 * FRAME_PADDING);
            const topBeadBaseY = FRAME_PADDING + BEAD_RADIUS;
            const bottomBeadBaseY = height - FRAME_PADDING - BEAD_RADIUS;
            const viewBox = `0 0 ${width} ${height}`;

            // Calculate offset to center the abacus with fewer digits
            const requiredWidth = (numDigits * ROD_SPACING) + ROD_SPACING;
            const offsetX = (width - requiredWidth) / 2;

            let svgContent = `
                <defs>
                    <linearGradient id="brownGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#A0522D;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#8B4513;stop-opacity:1" />
                    </linearGradient>
                </defs>
            `;
            svgContent += `<rect x="0" y="0" width="${width}" height="${height}" fill="white" stroke="${ABACUS_COLOR}" stroke-width="${ROD_WIDTH}" rx="10" ry="10" />`;
            svgContent += `<rect x="${offsetX + ROD_SPACING / 2}" y="${BEAM_Y - BEAM_HEIGHT / 2}" width="${requiredWidth - ROD_SPACING}" height="${BEAM_HEIGHT}" fill="${ABACUS_COLOR}" />`;

            const numberString = String(number).padStart(numDigits, '0');

            for (let i = 0; i < numDigits; i++) {
                const rodX = offsetX + i * ROD_SPACING + ROD_SPACING;
                const digit = parseInt(numberString[i]);
                const topBeadValue = Math.floor(digit / 5);
                const bottomBeadValue = digit % 5;
                const isUnitsRod = (i === numDigits - 1);

                svgContent += `<line x1="${rodX}" y1="${FRAME_PADDING}" x2="${rodX}" y2="${height - FRAME_PADDING}" stroke="${ABACUS_COLOR}" stroke-width="${ROD_WIDTH}" />`;

                const topBeadFill = 'url(#brownGradient)';
                const topBeadY = topBeadValue === 1 ? BEAM_Y - BEAD_RADIUS : topBeadBaseY;
                svgContent += `<polygon points="${getHexagonPoints(rodX, topBeadY, BEAD_RADIUS)}" fill="${topBeadFill}" stroke="${OUTLINE_COLOR}" stroke-width="0.5" />`;

                for (let j = 0; j < BOTTOM_BEADS; j++) {
                    const beadY = (j < bottomBeadValue)
                        ? (BEAM_Y + BEAD_RADIUS + BEAD_SPACING_Y * j)
                        : (bottomBeadBaseY - BEAD_SPACING_Y * (BOTTOM_BEADS - 1 - j));
                    
                    const beadFill = (isUnitsRod && j === 0) ? 'red' : 'url(#brownGradient)';
                    svgContent += `<polygon points="${getHexagonPoints(rodX, beadY, BEAD_RADIUS)}" fill="${beadFill}" stroke="${OUTLINE_COLOR}" stroke-width="0.5" />`;
                }
            }
            return `<svg viewBox="0 0 ${width} ${height}">${svgContent}</svg>`;
        }
        
        /**
         * Generates a random number with a specified number of digits.
         * Ensures the number falls within the correct range for the given number of digits.
         * @param {number} digits The number of digits.
         * @returns {number} A random number.
         */
        function generateRandomNumber(digits) {
            if (digits === 1) {
                return Math.floor(Math.random() * 10);
            }
            const min = Math.pow(10, digits - 1);
            const max = Math.pow(10, digits) - 1;
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        /**
         * Shows a message in a dedicated box.
         * @param {string} message The message to display.
         */
        function showMessage(message) {
            messageBox.textContent = message;
            messageBox.style.display = 'block';
            setTimeout(() => {
                messageBox.style.display = 'none';
            }, 3000);
        }

        /**
         * Starts the flashcard practice session after a short countdown.
         */
        function startPractice() {
            const digits = parseInt(digitsInput.value);
            const total = parseInt(totalInput.value);
            const speed = parseFloat(speedInput.value);

            if (isNaN(digits) || digits < 1 || digits > 6) {
                showMessage("Please enter a valid number of digits (1-6).");
                return;
            }
            if (isNaN(total) || total < 1) {
                showMessage("Please enter a valid total number of flashcards (1 or more).");
                return;
            }
            if (isNaN(speed) || speed <= 0) {
                showMessage("Please enter a valid speed (greater than 0).");
                return;
            }
            settings.digits = digits;
            settings.total = total;
            settings.speed = speed;
            currentIndex = 0;

            flashcardNumbers = [];
            if (settings.digits === 1) {
                let lastNumber = null;
                for (let i = 0; i < settings.total; i++) {
                    let newNumber;
                    do {
                        newNumber = generateRandomNumber(settings.digits);
                    } while (newNumber === lastNumber);
                    flashcardNumbers.push(newNumber);
                    lastNumber = newNumber;
                }
            } else {
                const uniqueNumbers = new Set();
                const maxPossibleNumbers = Math.pow(10, settings.digits) - Math.pow(10, settings.digits - 1);
                if (settings.total > maxPossibleNumbers) {
                    showMessage(`Cannot generate ${settings.total} unique numbers for ${settings.digits} digits. Please reduce the total flashcards or increase the digits.`);
                    return;
                }
                while (uniqueNumbers.size < settings.total) {
                    uniqueNumbers.add(generateRandomNumber(settings.digits));
                }
                flashcardNumbers = Array.from(uniqueNumbers);
            }

            // Hide controls and show countdown
            controlsDiv.style.display = 'none';
            countdownDiv.style.display = 'block';
            
            // Start the countdown
            startCountdown();
        }

        /**
         * Displays the countdown sequence before the practice starts.
         */
        function startCountdown() {
            countdownDiv.textContent = "Ready!";
            setTimeout(() => {
                countdownDiv.textContent = "Start!";
                setTimeout(() => {
                    countdownDiv.style.display = 'none';
                    flashcardDisplay.style.display = 'flex';
                    displayNextFlashcard();
                }, 1000); // Wait 1 second after "Start!"
            }, 1000); // Wait 1 second after "Ready!"
        }

        /**
         * Displays the next flashcard in the sequence.
         */
        function displayNextFlashcard() {
            if (currentIndex >= settings.total) {
                stopTimer();
                showResults();
                return;
            }
            
            const currentNumber = flashcardNumbers[currentIndex];
            currentNumberSpan.textContent = `Card ${currentIndex + 1} of ${settings.total}`;
            abacusContainer.innerHTML = generateAbacusSVG(currentNumber, settings.digits);
            currentIndex++;

            flashcardTimer = setTimeout(displayNextFlashcard, settings.speed * 1000);
        }
        
        /**
         * Stops the current practice timer.
         */
        function stopTimer() {
            if (flashcardTimer) {
                clearTimeout(flashcardTimer);
                flashcardTimer = null;
                showMessage("Practice session stopped.");
            }
        }

        /**
         * Displays the list of flashcard numbers after the session is complete.
         */
        function showResults() {
            flashcardDisplay.style.display = 'none';
            resultsDisplay.style.display = 'flex';
            resultsList.innerHTML = '';
            
            flashcardNumbers.forEach(num => {
                const listItem = document.createElement('div');
                listItem.className = 'results-list-item';
                listItem.textContent = num;
                resultsList.appendChild(listItem);
            });
        }

        /**
         * Resets the application to its initial state.
         */
        function resetApp() {
            stopTimer();
            // Explicitly set the display state of all main divs for robustness
            resultsDisplay.style.display = 'none';
            flashcardDisplay.style.display = 'none';
            countdownDiv.style.display = 'none';
            controlsDiv.style.display = 'flex';
            abacusContainer.innerHTML = '';
            currentNumberSpan.textContent = '';
        }

        // DOM element references
        const digitsInput = document.getElementById('digits');
        const totalInput = document.getElementById('total');
        const speedInput = document.getElementById('speed');
        const startButton = document.getElementById('startButton');
        const stopButton = document.getElementById('stopButton');
        const resetButton = document.getElementById('resetButton');
        const backButton = document.getElementById('backButton');
        const controlsDiv = document.getElementById('controls');
        const countdownDiv = document.getElementById('countdown');
        const flashcardDisplay = document.getElementById('flashcardDisplay');
        const currentNumberSpan = document.getElementById('currentNumber');
        const abacusContainer = document.getElementById('abacusContainer');
        const messageBox = document.getElementById('messageBox');
        const resultsDisplay = document.getElementById('resultsDisplay');
        const resultsList = document.getElementById('resultsList');

        // Event listeners
        startButton.addEventListener('click', startPractice);
        stopButton.addEventListener('click', stopTimer);
        resetButton.addEventListener('click', resetApp);
        backButton.addEventListener('click', resetApp);
    </script>
</body>
</html>

